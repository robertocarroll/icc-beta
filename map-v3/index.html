<!DOCTYPE html>
<meta charset="utf-8">
<title>World Map</title>

 <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<link href="../assets/build/main.css" type="text/css" rel="stylesheet">
<style>

body {
	padding: 0;
	margin: 0;
	background-color: #efefef;
}

.coastline {
  fill: none;
  stroke: #D5D5D5;
  stroke-linejoin: round;
}

.country {
  fill: #fff;
  stroke: #fff;
  stroke-linejoin: round;
  stroke-linecap: round;
}

.situation {
  fill: #244676; 
}

.preliminary	{
  fill: #AABFD4; 
}

.situation:hover, .preliminary:hover {
	fill: #d95b12;
	cursor: pointer; 
	cursor: hand;
}

.links {
	margin-top: -50px;
}

h2 {
	font-size: 16px;
	text-transform: uppercase;
	font-weight: 700;
}

ul {
	list-style-type: none;
	padding:0; 
	margin:0;
}

li {
  display: block;
  padding: 4px 0;
  border-bottom: 1px dotted #ccc;
}

.key {
  	  float: left;
  	  height:9px; 
      width: 10px;
      display: inline-block;
      line-height: 12px;
      font-size: 10px;
      vertical-align: middle;
      margin-right: 6px;
      margin-top: 4px;
  }


.hidden { 
  display: none; 
}

div.tooltip {
  color: #222; 
  background: #fff; 
  padding: .5em; 
  border-radius: 2px; 
  box-shadow: 0px 0px 2px 0px #a6a6a6; 
  position: absolute;
  z-index: 2;
}

@media only screen and (min-device-width : 320px) and (max-device-width : 960px) {
	 .links {
		 	padding:20px;
			margin-top: 0px;
		}
	.col {
		padding-top: 30px;
	}
}

</style>

</head>
<body>

  	<div id="map-no-show"></div>


  <div class="links">  
			  <div class="col three padded-left">&nbsp;</div>

			  <div class="col three padded-right">
			  	<span class="key" style='background:#AABFD4;'></span><h2>Ongoing preliminary examinations</h2>
			  	<ul id="pe">
			  		<li class="country-link" id="Afghanistan"><a href="/en_menus/icc/structure%20of%20the%20court/office%20of%20the%20prosecutor/comm%20and%20ref/pe-ongoing/afghanistan" >Afghanistan</a></li>
			  		<li class="country-link" id="Colombia"><a href="/en_menus/icc/structure%20of%20the%20court/office%20of%20the%20prosecutor/comm%20and%20ref/pe-ongoing/colombia" >Colombia</a></li><li class="country-link" id="Comoros"><a href="/en_menus/icc/structure%20of%20the%20court/office%20of%20the%20prosecutor/comm%20and%20ref/pe-ongoing/comoros" >Comoros</a></li>
			  		<li class="country-link" id="Nigeria"><a href="/en_menus/icc/structure%20of%20the%20court/office%20of%20the%20prosecutor/comm%20and%20ref/pe-ongoing/nigeria" >Nigeria</a></li>
			  		<li class="country-link" id="Georgia"><a href="/en_menus/icc/structure%20of%20the%20court/office%20of%20the%20prosecutor/comm%20and%20ref/pe-ongoing/georgia" >Georgia</a></li>
			  		<li class="country-link" id="Guinea"><a href="/en_menus/icc/structure%20of%20the%20court/office%20of%20the%20prosecutor/comm%20and%20ref/pe-ongoing/guinea" >Guinea</a></li><li class="country-link" id="Honduras"><a href="/en_menus/icc/structure%20of%20the%20court/office%20of%20the%20prosecutor/comm%20and%20ref/pe-ongoing/honduras" >Honduras</a></li><li id="Iraq" class="country-link"><a href="/EN_Menus/icc/structure%20of%20the%20court/office%20of%20the%20prosecutor/comm%20and%20ref/pe-ongoing/iraq/pages/iraq.aspx" >Iraq</a></li><li class="country-link" id="Ukraine"><a href="/en_menus/icc/structure%20of%20the%20court/office%20of%20the%20prosecutor/comm%20and%20ref/pe-ongoing/ukraine/Pages/ukraine.aspx" >Ukraine</a></li>
			  	</ul>
		  	
					</div>

					<div class="col three padded">

						<span class="key" style='background:#00275D;'></span><h2>Situations under investigation</h2>
			  	<ul>
			  		<li class="country-link" id="DRC"><a href="/en_menus/icc/situations%20and%20cases/situations/situation%20icc%200104" >Democratic Republic of the Congo</a></li>
			     	<li class="country-link" id="Uganda"><a href="/en_menus/icc/situations%20and%20cases/situations/situation%20icc%200204" >Uganda</a></li>
			      <li class="country-link" id="CAR"><a href="/en_menus/icc/situations%20and%20cases/situations/situation%20icc%200105" >Central African Republic</a></li>
             <li class="country-link" id="Darfur"><a href="/en_menus/icc/situations%20and%20cases/situations/situation%20icc%200205" >Darfur, Sudan</a></li>
           		<li class="country-link" id="Kenya"><a href="/en_menus/icc/situations%20and%20cases/situations/situation%20icc%200109" >Kenya</a></li>
         			<li class="country-link" id="Libya"><a href="/en_menus/icc/situations%20and%20cases/situations/icc0111" >Libya</a></li>
             	<li class="country-link" id="CDI"><a href="/en_menus/icc/situations%20and%20cases/situations/icc0211" >Côte d’Ivoire</a></li>
             	<li class="country-link" id="Mali"><a href="/en_menus/icc/situations%20and%20cases/situations/icc0112" >Mali</a></li>
             	<li class="country-link" id="CAR-2"><a href="/EN_Menus/icc/situations%20and%20cases/situations/icc-01-14" >Central African Republic II</a></li>
               </ul>		  	
           </div>       

           	<div class="col three padded-left">&nbsp;</div> 
			  </div>           	 

<script src="javascripts/d3.min.js"></script>
<script src="javascripts/topojson.v1.min.js"></script>
<script src="javascripts/queue.v1.min.js"></script>
<script src="javascripts/modernizr-svg-only.js"></script>

<script>

if('querySelector' in document
     && 'addEventListener' in window) {
     	var jsCheck = document.getElementById('map-no-show');
			jsCheck.id="map"; 
     }

// Calls the resize function 
d3.select(window).on("resize", throttle);

// Set the height and width
var padding = 5;
var scaleSetting = 1.7;
var width = document.getElementById('map').offsetWidth-padding;
var height = width / scaleSetting;
var activeCountries, topo, borders, coastline, projection, path, svg, g;
var tooltip = d3.select("#map").append("div").attr("class", "tooltip hidden");

if (width > 520) {
	setup(width,height);
}


//initial setup
function setup(width,height){
	//Try d3.geo.azimuthalEqualArea() / d3.geo.mercator()
  projection = d3.geo.mercator()
    .translate([(width/2), (height/2)])
    .scale(width / scaleSetting / Math.PI);

  path = d3.geo.path().projection(projection);

  svg = d3.select("#map").append("svg")
      .attr("width", width)
      .attr("height", height)
      .append("g");

  g = svg.append("g");
}

//Loads in the world data and the active countries
queue()
    .defer(d3.json, "data/world-topo.json")
    .defer(d3.csv, "data/active.csv")
    .await(ready);

function ready(error, world, active) {
	var countries = topojson.feature(world, world.objects.countries).features;
  topo = countries;
  activeCountries = active;

  coastline = topojson.mesh(world, world.objects.countries, function(a, b) { return a === b });

  topo.forEach(function(d, i) {
        activeCountries.forEach(function(e, j) {
            if (d.id === e.id) {
                e.geometry = d.geometry;
                e.type = d.type;
            }
        })
    })

  draw(topo, activeCountries, coastline);
}

function draw(topo, activeCountries, coastline) {
	 var activeCountry = g.selectAll(".activeCountry").data(activeCountries);

	 g.selectAll(".country")
	      .data(topo)
	     .enter().append("path")
	    	.attr("class", "country")
	    	.attr("id", function(d) { return d.id; })
	      .attr("d", path); 
	 
	 g.insert("path", ".graticule")
	 		.datum(coastline)
	 		.attr("class","coastline")
			.attr("d", path);     

	activeCountry.enter().append("path")
    	.attr("class", function(d,i) { return d.status; })
    	.attr("id", function(d) { return d.id; })
      .attr("d", path);

  //ofsets plus width/height of transform, plus 20 px of padding, plus 20 extra for tooltip offset off mouse
  var offsetL = document.getElementById('map').offsetLeft+(width/80);
  var offsetT =document.getElementById('map').offsetTop+(height/80);    

  activeCountry
	  .on("mousemove", function(d,i) {
	      var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );
	        tooltip
	          .classed("hidden", false)
	          .attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+offsetT)+"px")
	          .html(d.name)
	      })
	      .on("mouseout",  function(d,i) {
	        tooltip.classed("hidden", true)
	      });    

  activeCountry.on('click', function(d){ window.location = d.url;});    

}

function redraw() {
  width = document.getElementById('map').offsetWidth-padding;
  height = width / scaleSetting;
  d3.select('svg').remove();
  setup(width,height);
  draw(topo, activeCountries, coastline);
}

var throttleTimer;
function throttle() {
  window.clearTimeout(throttleTimer);
    throttleTimer = window.setTimeout(function() {
      redraw();
    }, 200);
}

</script>
</body>
</html>